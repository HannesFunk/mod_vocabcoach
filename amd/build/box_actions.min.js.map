{"version":3,"file":"box_actions.min.js","sources":["../src/box_actions.js"],"sourcesContent":["import notification from 'core/notification';\nimport {getClassTotalAJAX} from \"./repository\";\n\nconst Selectors = {\n    actions: {\n        checkBox: '[data-action=\"mod_vocabcoach/check_box\"]',\n        addUserVocab: '[data-action=\"mod_vocabcoach/add_vocab_user\"]',\n        addList: '[data-action=\"mod_vocabcoach/add_vocab_list\"]',\n        showLists: '[data-action=\"mod_vocabcoach/show_lists\"]',\n        forceCheck: '[data-action=\"mod_vocabcoach/force_check_all\"]',\n        showPdfUser: '[data-action=\"mod_vocabcoach/show_pdf_user\"]',\n        viewBox: '[data-action=\"mod_vocabcoach/view_box\"]',\n    },\n    elements: {\n        dropdown: '.dropdown',\n    }\n};\n\nexport function init(cmid, userid, courseid) {\n    document.addEventListener('click', e => {\n        if (e.target.closest(Selectors.actions.forceCheck)) {\n            checkBox(cmid, e.target.closest(Selectors.actions.checkBox), true);\n        } else if (e.target.closest(Selectors.actions.showPdfUser)) {\n            const stage = e.target.closest(Selectors.actions.showPdfUser).getAttribute('data-stage');\n            window.open('exorts/pdf.php?userid=' + userid + '&cmid=' +\n                cmid + '&stage=' + stage);\n        } else if (e.target.closest(Selectors.actions.viewBox)) {\n            const stage = e.target.closest(Selectors.actions.viewBox).getAttribute('data-stage');\n            location.href = 'viewbox.php?id=' + cmid + '&stage=' + stage;\n        } else if (e.target.closest(Selectors.elements.dropdown)) {\n            return false;\n        }  else if (e.target.closest(Selectors.actions.checkBox)) {\n           checkBox(cmid, e.target.closest(Selectors.actions.checkBox));\n        } else if (e.target.closest(Selectors.actions.addUserVocab)) {\n            location.href = 'add_vocab.php?id=' + cmid + '&mode=user';\n        } else if (e.target.closest(Selectors.actions.addList)) {\n            location.href = 'add_vocab.php?id=' + cmid + '&mode=list';\n        } else if (e.target.closest(Selectors.actions.showLists)) {\n            location.href = 'lists.php?id=' + cmid;\n        }\n    });\n\n    getClassTotalAJAX(cmid, courseid).then(\n        (result) => {\n            document.getElementById('vocabcoach-class-total').innerHTML = result.total;\n        }\n    );\n    setInterval( () => {\n        getClassTotalAJAX(cmid, courseid).then(\n            (result) => {\n                document.getElementById('vocabcoach-class-total').innerHTML = result.total;\n            }\n        );\n    }, 1000);\n}\n\nfunction checkBox(cmid, box, force = false) {\n    if (parseInt(box.getAttribute('data-total')) === 0) {\n        const msgData = {\n            type: \"info\",\n            message: 'In dieser Box sind zur Zeit keine Vokabeln enthalten.'\n        };\n        notification.addNotification(msgData).then(null);\n    } else if (force && parseInt(box.getAttribute('data-due')) > 0) {\n        notification.addNotification({type: 'info',\n            message: 'Wiederhole zuerst die aktuell fälligen Vokabeln in dieser Box. ' +\n                'Erst danach kannst du auch die anderen abfragen.'}).then(null);\n    } else if (!force && parseInt(box.getAttribute('data-due')) === 0) {\n        const dueTime =  box.getAttribute('data-next-due');\n        const msgData = {\n            type: \"info\",\n            message : \"In dieser Box hast du bereits alle Vokabeln gelernt. Die nächsten Vokabeln sind in \" + dueTime\n            +\" fällig.\"\n        };\n        notification.addNotification(msgData).then(null);\n    } else {\n        const stage = box.getAttribute('data-stage');\n        location.href = 'check.php?id=' + cmid + '&stage=' + stage + \"&force=\" + force;\n    }\n}\n"],"names":["cmid","userid","courseid","document","addEventListener","e","target","closest","Selectors","forceCheck","checkBox","showPdfUser","stage","getAttribute","window","open","viewBox","location","href","dropdown","addUserVocab","addList","showLists","then","result","getElementById","innerHTML","total","setInterval","box","force","parseInt","msgData","type","message","addNotification"],"mappings":"wNAkBqBA,KAAMC,OAAQC,UAC/BC,SAASC,iBAAiB,SAASC,OAC3BA,EAAEC,OAAOC,QAAQC,kBAAkBC,YACnCC,SAASV,KAAMK,EAAEC,OAAOC,QAAQC,kBAAkBE,WAAW,QAC1D,GAAIL,EAAEC,OAAOC,QAAQC,kBAAkBG,aAAc,OAClDC,MAAQP,EAAEC,OAAOC,QAAQC,kBAAkBG,aAAaE,aAAa,cAC3EC,OAAOC,KAAK,yBAA2Bd,OAAS,SAC5CD,KAAO,UAAYY,YACpB,GAAIP,EAAEC,OAAOC,QAAQC,kBAAkBQ,SAAU,OAC9CJ,MAAQP,EAAEC,OAAOC,QAAQC,kBAAkBQ,SAASH,aAAa,cACvEI,SAASC,KAAO,kBAAoBlB,KAAO,UAAYY,UACpD,CAAA,GAAIP,EAAEC,OAAOC,QAAQC,mBAAmBW,iBACpC,EACCd,EAAEC,OAAOC,QAAQC,kBAAkBE,UAC5CA,SAASV,KAAMK,EAAEC,OAAOC,QAAQC,kBAAkBE,WAC1CL,EAAEC,OAAOC,QAAQC,kBAAkBY,cAC1CH,SAASC,KAAO,oBAAsBlB,KAAO,aACtCK,EAAEC,OAAOC,QAAQC,kBAAkBa,SAC1CJ,SAASC,KAAO,oBAAsBlB,KAAO,aACtCK,EAAEC,OAAOC,QAAQC,kBAAkBc,aAC1CL,SAASC,KAAO,gBAAkBlB,4CAIxBA,KAAME,UAAUqB,MAC7BC,SACGrB,SAASsB,eAAe,0BAA0BC,UAAYF,OAAOG,SAG7EC,aAAa,uCACS5B,KAAME,UAAUqB,MAC7BC,SACGrB,SAASsB,eAAe,0BAA0BC,UAAYF,OAAOG,WAG9E,gFAlDDnB,kBACO,CACLE,SAAU,2CACVU,aAAc,gDACdC,QAAS,gDACTC,UAAW,4CACXb,WAAY,iDACZE,YAAa,+CACbK,QAAS,2CARXR,mBAUQ,CACNW,SAAU,sBA0CTT,SAASV,KAAM6B,SAAKC,iEACwB,IAA7CC,SAASF,IAAIhB,aAAa,eAAsB,OAC1CmB,QAAU,CACZC,KAAM,OACNC,QAAS,+EAEAC,gBAAgBH,SAAST,KAAK,WACxC,GAAIO,OAASC,SAASF,IAAIhB,aAAa,aAAe,wBAC5CsB,gBAAgB,CAACF,KAAM,OAChCC,QAAS,oHACgDX,KAAK,WAC/D,GAAKO,OAAoD,IAA3CC,SAASF,IAAIhB,aAAa,aAQxC,OACGD,MAAQiB,IAAIhB,aAAa,cAC/BI,SAASC,KAAO,gBAAkBlB,KAAO,UAAYY,MAAQ,UAAYkB,UAVV,OAEzDE,QAAU,CACZC,KAAM,OACNC,QAAU,sFAHGL,IAAIhB,aAAa,iBAI7B,kCAEQsB,gBAAgBH,SAAST,KAAK"}