{"version":3,"file":"check.min.js","sources":["../src/check.js"],"sourcesContent":["import {getBoxArrayAJAX, getListArrayAJAX, updateVocabAJAX} from \"./repository\";\nimport mustache from 'core/mustache';\nimport {showElement, showElements} from \"./general\";\n\nlet vocabArrayJSON = null;\nlet modid = -1;\nlet knownCount = 0;\nlet unknownCount = 0;\nlet mode = 'front';\nlet force = false;\n\nexport const init = (userid, addInfo, moduleid, force_init = false) => {\n    modid = moduleid;\n    userid = parseInt(userid);\n    force = force_init;\n    if (userid === -1) {\n        getListArrayAJAX(addInfo).then(response => {\n            vocabArrayJSON = response;\n            showNext(false);\n            }\n        );\n    } else {\n        getBoxArrayAJAX(userid, modid, addInfo, force).then(response => {\n            vocabArrayJSON = response;\n            showNext(false);\n            }\n        );\n    }\n    addListeners(userid);\n};\n\nfunction addListeners(userid) {\n    document.addEventListener('click', e => {\n        if (e.target.closest(Selectors.actions.checkTypedVocab)) {\n            checkTypedVocab(userid);\n        } else if (e.target.closest(Selectors.actions.revealCard) && mode !== 'type') {\n            const label = e.target.closest(Selectors.actions.revealCard).getElementsByClassName('vc-check-label')[0];\n            showElement(label, true);\n        } else if (e.target.closest(Selectors.actions.updateVocab)) {\n            checkDone(vocabArrayJSON[0].dataid, userid, e.target.getAttribute('data-vocabcoach-known') === 'true');\n        } else if (e.target.closest(Selectors.actions.endCheck)) {\n            endCheck();\n        } else if (e.target.closest(Selectors.actions.revealTypedVocab)) {\n            document.getElementById('input-vocab-front').value = vocabArrayJSON[0].front;\n            document.getElementById('input-vocab-front').disabled = true;\n\n            showElements(['button-typed-vocab-next'], true);\n            showElements(['button-typed-vocab-check', 'button-typed-vocab-reveal'], false);\n        } else if (e.target.closest(Selectors.actions.typedVocabUnknown)) {\n            showElements(['button-typed-vocab-next'], false);\n            showElements(['button-typed-vocab-reveal', 'button-typed-vocab-check'], true);\n\n            document.getElementById('input-vocab-front').value = '';\n            document.getElementById('input-vocab-front').disabled = false;\n\n            updateVocabAJAX(vocabArrayJSON[0].dataid, userid, false).then(() => { showNext();});\n        }\n    });\n\n    document.addEventListener('change', e => {\n        if (e.target.closest(Selectors.formElements.mode)) {\n            changeMode();\n        }\n    });\n\n    document.addEventListener('keyup', e => {\n        if (e.target.closest(Selectors.formElements.typedVocab)) {\n            document.getElementById('input-vocab-front').classList.remove('wrong');\n        }\n    });\n}\n\nconst Selectors = {\n    actions: {\n        revealCard: '[data-action=\"mod_vocabcoach/reveal-card\"]',\n        updateVocab: '[data-action=\"mod_vocabcoach/update-vocab\"]',\n        endCheck: '[data-action=\"mod_vocabcoach/end-check\"]',\n        modeChanged: '[data-action=\"mod-vocabcoach/change-mode\"]',\n        checkTypedVocab: '[data-action=\"mod-vocabcoach/typed-vocab-check\"]',\n        revealTypedVocab: '[data-action=\"mod-vocabcoach/typed-vocab-reveal\"]',\n        typedVocabUnknown: '[data-action=\"mod-vocabcoach/typed-vocab-unknown\"]',\n    },\n    formElements : {\n        mode: '[id=\"check-mode\"]',\n        typedVocab: '[id=\"input-vocab-front\"]',\n    },\n};\nexport function changeMode() {\n    mode = document.getElementById('check-mode').value;\n    vocabArrayJSON = shuffle(vocabArrayJSON);\n    const checkAreaElem = document.getElementById('check-area');\n    startAnimation(checkAreaElem, 'animation-slide-out').then(\n        () => {\n            if (mode === 'type') {\n                showElements(['check-box-front', 'check-buttons'], false);\n                showElements(['check-back', 'check-type-area'], true);\n                document.getElementById('input-vocab-front').value = '';\n                showElement(document.getElementsByClassName('instruction-front-back-random')[0], false);\n            } else {\n                showElements(['check-buttons', 'check-box-front'], true);\n                showElements(['check-type-area'], false);\n                showElement(document.getElementsByClassName('instruction-front-back-random')[0], true);\n            }\n            resetCheckFields();\n            updateLabels();\n            startAnimation(checkAreaElem, 'animation-slide-in').then(null);\n        });\n}\n\nfunction checkTypedVocab (userid) {\n    const typed = document.getElementById('input-vocab-front').value;\n    const correct = vocabArrayJSON[0].front;\n\n    if (typed === correct && !force) {\n        updateVocabAJAX(vocabArrayJSON[0].dataid, userid, true).then(\n            () => {\n                knownCount++;\n                showNext();\n            }\n        );\n    } else if (typed === correct) {\n        knownCount++;\n        showNext();\n    } else {\n        document.getElementById('input-vocab-front').classList.add('wrong');\n    }\n}\n\nfunction showNext(removeShown = true) {\n    if (removeShown) {\n        vocabArrayJSON.splice(0, 1);\n    }\n\n    const numberRemaining = vocabArrayJSON.length;\n    document.getElementsByClassName('check-number-remaining')[0].innerHTML = 'Noch ' + numberRemaining +\n        ' Vokabel' + (numberRemaining === 1 ? '' : 'n');\n\n    if (numberRemaining === 0) {\n        showSummary();\n        return;\n    }\n\n    const checkAreaElem = document.getElementById('check-area');\n    startAnimation(checkAreaElem, 'animation-slide-out').then(\n        () => {\n            resetCheckFields();\n            updateLabels();\n            startAnimation(checkAreaElem, 'animation-slide-in').then(null);\n        }\n    );\n}\n\nfunction updateLabels () {\n    document.getElementById('check-front').innerHTML = vocabArrayJSON[0].front;\n    document.getElementById('check-back').innerHTML = vocabArrayJSON[0].back;\n    document.getElementById('check-container').setAttribute('data-vocab-data-id', vocabArrayJSON[0].dataid);\n}\nfunction resetCheckFields() {\n    switch (mode) {\n        case 'random': {\n            const random = Math.floor(Math.random() * 2);\n            showElement('check-front', random === 1);\n            showElement('check-back', random === 0);\n            break;\n        }\n        case 'front':\n        case 'back':\n            showElement('check-front', mode === 'front');\n            showElement('check-back', mode === 'back');\n            break;\n\n        case 'type':\n            document.getElementById('input-vocab-front').value = '';\n            break;\n    }\n}\n\nfunction endCheck() {\n    location.href = '../../mod/vocabcoach/view.php?id=' + modid;\n}\n\nfunction showSummary() {\n    const templateData = {\n        known: knownCount,\n        total: knownCount + unknownCount,\n        message: getSummaryMessage()\n    };\n    fetch('../../mod/vocabcoach/templates/check_summary.mustache').then(\n        (res) => {\n            return res.text();\n        }\n    ).then(\n        (template) => {\n            const output = mustache.render(template, templateData);\n            const summaryContainer = document.getElementsByClassName('check-summary')[0];\n            summaryContainer.innerHTML = output;\n            showElement(summaryContainer, true);\n            showElements(['check-box-front', 'check-box-back'], false);\n        }\n    );\n}\n\nfunction getSummaryMessage() {\n    const ratio = knownCount/(unknownCount + knownCount);\n\n    if (ratio > 0.9) {\n        return \"Hervorragend!\";\n    }\n    if (ratio > 0.7) {\n        return \"Gut gemacht!\";\n    }\n    if (ratio > 0.5) {\n        return \"Du hast einiges erreicht!\";\n    }\n    if (ratio > 0.3) {\n        return \"Das kannst du besser!\";\n    }\n    return \"Hm. Da musst du nochmal ran!\";\n}\n\nfunction checkDone(vocabId, userId, known) {\n    if (userId === -1 || force) {\n        updateCount(known);\n        showNext();\n    }\n    else {\n    updateVocabAJAX(vocabId, userId, known).then(\n            () => {\n                updateCount(known);\n                showNext();\n            }\n        );\n    }\n}\n\nfunction updateCount(known) {\n    if (known) {\n        knownCount++;\n    } else {\n        unknownCount++;\n    }\n}\n\nfunction shuffle(array) {\n    for (let i = array.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [array[i], array[j]] = [array[j], array[i]];\n    }\n    return array;\n}\n\nlet startAnimation = (el, animation) => {\n    return new Promise(resolve => {\n        const listener = () => {\n            el.removeEventListener('animationend', listener);\n            el.classList.remove(animation);\n            resolve();\n        };\n        el.addEventListener('animationend', listener);\n        el.classList.add(animation);\n    });\n};"],"names":["vocabArrayJSON","modid","knownCount","unknownCount","mode","force","addListeners","userid","document","addEventListener","e","target","closest","Selectors","actions","checkTypedVocab","typed","getElementById","value","correct","front","showNext","classList","add","dataid","then","revealCard","label","getElementsByClassName","updateVocab","vocabId","userId","known","getAttribute","updateCount","endCheck","location","href","revealTypedVocab","disabled","typedVocabUnknown","formElements","changeMode","typedVocab","remove","addInfo","moduleid","force_init","parseInt","response","modeChanged","array","i","length","j","Math","floor","random","shuffle","checkAreaElem","startAnimation","resetCheckFields","updateLabels","removeShown","splice","numberRemaining","innerHTML","showSummary","back","setAttribute","templateData","total","message","getSummaryMessage","fetch","res","text","template","output","mustache","render","summaryContainer","ratio","el","animation","Promise","resolve","listener","removeEventListener"],"mappings":"4TAIIA,eAAiB,KACjBC,OAAS,EACTC,WAAa,EACbC,aAAe,EACfC,KAAO,QACPC,OAAQ,WAsBHC,aAAaC,QAClBC,SAASC,iBAAiB,SAASC,OAC3BA,EAAEC,OAAOC,QAAQC,UAAUC,QAAQC,2BA4ErBR,cAChBS,MAAQR,SAASS,eAAe,qBAAqBC,MACrDC,QAAUnB,eAAe,GAAGoB,MAE9BJ,QAAUG,SAAYd,MAOfW,QAAUG,SACjBjB,aACAmB,YAEAb,SAASS,eAAe,qBAAqBK,UAAUC,IAAI,yCAV3CvB,eAAe,GAAGwB,OAAQjB,QAAQ,GAAMkB,MACpD,KACIvB,aACAmB,cAnFJN,CAAgBR,aACb,GAAIG,EAAEC,OAAOC,QAAQC,UAAUC,QAAQY,aAAwB,SAATtB,KAAiB,OACpEuB,MAAQjB,EAAEC,OAAOC,QAAQC,UAAUC,QAAQY,YAAYE,uBAAuB,kBAAkB,4BAC1FD,OAAO,QACZjB,EAAEC,OAAOC,QAAQC,UAAUC,QAAQe,cAsLnCC,QArLG9B,eAAe,GAAGwB,OAqLZO,OArLoBxB,OAqLZyB,MArLuE,SAAnDtB,EAAEC,OAAOsB,aAAa,0BAsL1D,IAAZF,QAAiB1B,OACjB6B,YAAYF,OACZX,4CAGYS,QAASC,OAAQC,OAAOP,MAChC,KACIS,YAAYF,OACZX,eA7LGX,EAAEC,OAAOC,QAAQC,UAAUC,QAAQqB,UA0IlDC,SAASC,KAAO,oCAAsCpC,MAxIvCS,EAAEC,OAAOC,QAAQC,UAAUC,QAAQwB,mBAC1C9B,SAASS,eAAe,qBAAqBC,MAAQlB,eAAe,GAAGoB,MACvEZ,SAASS,eAAe,qBAAqBsB,UAAW,4BAE3C,CAAC,4BAA4B,6BAC7B,CAAC,2BAA4B,8BAA8B,IACjE7B,EAAEC,OAAOC,QAAQC,UAAUC,QAAQ0B,+CAC7B,CAAC,4BAA4B,6BAC7B,CAAC,4BAA6B,6BAA6B,GAExEhC,SAASS,eAAe,qBAAqBC,MAAQ,GACrDV,SAASS,eAAe,qBAAqBsB,UAAW,kCAExCvC,eAAe,GAAGwB,OAAQjB,QAAQ,GAAOkB,MAAK,KAAQJ,mBAqK/DS,QAASC,OAAQC,SAjKhCxB,SAASC,iBAAiB,UAAUC,IAC5BA,EAAEC,OAAOC,QAAQC,UAAU4B,aAAarC,OACxCsC,gBAIRlC,SAASC,iBAAiB,SAASC,IAC3BA,EAAEC,OAAOC,QAAQC,UAAU4B,aAAaE,aACxCnC,SAASS,eAAe,qBAAqBK,UAAUsB,OAAO,0BAxDtD,SAACrC,OAAQsC,QAASC,cAAUC,mEAC5C9C,MAAQ6C,SACRvC,OAASyC,SAASzC,QAClBF,MAAQ0C,YACQ,IAAZxC,wCACiBsC,SAASpB,MAAKwB,WAC3BjD,eAAiBiD,SACjB5B,UAAS,sCAIGd,OAAQN,MAAO4C,QAASxC,OAAOoB,MAAKwB,WAChDjD,eAAiBiD,SACjB5B,UAAS,MAIjBf,aAAaC,eA4CXM,UAAY,CACdC,QAAS,CACLY,WAAY,6CACZG,YAAa,8CACbM,SAAU,2CACVe,YAAa,6CACbnC,gBAAiB,mDACjBuB,iBAAkB,oDAClBE,kBAAmB,sDAEvBC,aAAe,CACXrC,KAAM,oBACNuC,WAAY,sCAGJD,aACZtC,KAAOI,SAASS,eAAe,cAAcC,MAC7ClB,wBA0JamD,WACR,IAAIC,EAAID,MAAME,OAAS,EAAGD,EAAI,EAAGA,IAAK,OACjCE,EAAIC,KAAKC,MAAMD,KAAKE,UAAYL,EAAI,KACzCD,MAAMC,GAAID,MAAMG,IAAM,CAACH,MAAMG,GAAIH,MAAMC,WAErCD,MA/JUO,CAAQ1D,sBACnB2D,cAAgBnD,SAASS,eAAe,cAC9C2C,eAAeD,cAAe,uBAAuBlC,MACjD,KACiB,SAATrB,gCACa,CAAC,kBAAmB,kBAAkB,6BACtC,CAAC,aAAc,oBAAoB,GAChDI,SAASS,eAAe,qBAAqBC,MAAQ,4BACzCV,SAASoB,uBAAuB,iCAAiC,IAAI,+BAEpE,CAAC,gBAAiB,oBAAoB,6BACtC,CAAC,oBAAoB,4BACtBpB,SAASoB,uBAAuB,iCAAiC,IAAI,IAErFiC,mBACAC,eACAF,eAAeD,cAAe,sBAAsBlC,KAAK,kBAuB5DJ,eAAS0C,uEACVA,aACA/D,eAAegE,OAAO,EAAG,SAGvBC,gBAAkBjE,eAAeqD,UACvC7C,SAASoB,uBAAuB,0BAA0B,GAAGsC,UAAY,QAAUD,gBAC/E,YAAkC,IAApBA,gBAAwB,GAAK,KAEvB,IAApBA,4BACAE,oBAIER,cAAgBnD,SAASS,eAAe,cAC9C2C,eAAeD,cAAe,uBAAuBlC,MACjD,KACIoC,mBACAC,eACAF,eAAeD,cAAe,sBAAsBlC,KAAK,kBAK5DqC,eACLtD,SAASS,eAAe,eAAeiD,UAAYlE,eAAe,GAAGoB,MACrEZ,SAASS,eAAe,cAAciD,UAAYlE,eAAe,GAAGoE,KACpE5D,SAASS,eAAe,mBAAmBoD,aAAa,qBAAsBrE,eAAe,GAAGwB,iBAE3FqC,0BACGzD,UACC,gBACKqD,OAASF,KAAKC,MAAsB,EAAhBD,KAAKE,mCACnB,cAA0B,IAAXA,iCACf,aAAyB,IAAXA,kBAGzB,YACA,gCACW,cAAwB,UAATrD,+BACf,aAAuB,SAATA,gBAGzB,OACDI,SAASS,eAAe,qBAAqBC,MAAQ,aASxDiD,oBACCG,aAAe,CACjBtC,MAAO9B,WACPqE,MAAOrE,WAAaC,aACpBqE,QAASC,qBAEbC,MAAM,yDAAyDjD,MAC1DkD,KACUA,IAAIC,SAEjBnD,MACGoD,iBACSC,OAASC,kBAASC,OAAOH,SAAUP,cACnCW,iBAAmBzE,SAASoB,uBAAuB,iBAAiB,GAC1EqD,iBAAiBf,UAAYY,gCACjBG,kBAAkB,6BACjB,CAAC,kBAAmB,mBAAmB,eAKvDR,0BACCS,MAAQhF,YAAYC,aAAeD,mBAErCgF,MAAQ,GACD,gBAEPA,MAAQ,GACD,eAEPA,MAAQ,GACD,4BAEPA,MAAQ,GACD,wBAEJ,wCAkBFhD,YAAYF,OACbA,MACA9B,aAEAC,mBAYJyD,eAAiB,CAACuB,GAAIC,YACf,IAAIC,SAAQC,gBACTC,SAAW,KACbJ,GAAGK,oBAAoB,eAAgBD,UACvCJ,GAAG7D,UAAUsB,OAAOwC,WACpBE,WAEJH,GAAG1E,iBAAiB,eAAgB8E,UACpCJ,GAAG7D,UAAUC,IAAI6D"}