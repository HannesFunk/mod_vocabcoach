{"version":3,"file":"check.min.js","sources":["../src/check.js"],"sourcesContent":["import {getBoxArrayAJAX, getListArrayAJAX, updateVocabAJAX} from \"./repository\";\nimport mustache from 'core/mustache';\n\nlet vocabArrayJSON = null;\nlet modid = -1;\nlet knownCount = 0;\nlet unknownCount = 0;\nlet mode = 'front';\n\nexport const init = (userid, addInfo, moduleid) => {\n    modid = moduleid;\n    userid = parseInt(userid);\n    if (userid === -1) {\n        getListVocab(addInfo);\n    } else {\n        getBoxVocab(userid, addInfo);\n    }\n    addListeners(userid);\n    resetCheckFields();\n};\n\nfunction addListeners(userid) {\n    document.addEventListener('click', e => {\n        if (e.target.closest(Selectors.actions.checkTypedVocab)) {\n            checkTypedVocab(userid);\n        } else if (e.target.closest(Selectors.actions.revealCard) && mode !== 'type') {\n            reveal(e.target);\n        } else if (e.target.closest(Selectors.actions.updateVocab)) {\n            checkDone(vocabArrayJSON[0].dataid, userid, e.target.getAttribute('data-vocabcoach-known') === 'true');\n        } else if (e.target.closest(Selectors.actions.endCheck)) {\n            endCheck();\n        } else if (e.target.closest(Selectors.actions.revealTypedVocab)) {\n            document.getElementById('input-vocab-front').value = vocabArrayJSON[0].front;\n            document.getElementById('input-vocab-front').disabled = true;\n            document.getElementById('button-typed-vocab-next').style.display = 'unset';\n            document.getElementById('button-typed-vocab-check').style.display = 'none';\n            document.getElementById('button-typed-vocab-reveal').style.display = 'none';\n        } else if (e.target.closest(Selectors.actions.typedVocabUnkown)) {\n            document.getElementById('button-typed-vocab-next').style.display = 'none';\n            document.getElementById('input-vocab-front').value = '';\n            document.getElementById('input-vocab-front').disabled = false;\n            document.getElementById('button-typed-vocab-check').style.display = 'unset';\n            document.getElementById('button-typed-vocab-reveal').style.display = 'unset';\n            updateVocabAJAX(vocabArrayJSON[0].dataid, userid, false).then(() => { showNext();});\n        }\n    });\n\n    document.addEventListener('change', e => {\n        if (e.target.closest(Selectors.formElements.mode)) {\n            changeMode();\n        }\n    });\n\n    document.addEventListener('keyup', e => {\n        if (e.target.closest(Selectors.formElements.typedVocab)) {\n            document.getElementById('input-vocab-front').classList.remove('wrong');\n        }\n    });\n}\n\nconst Selectors = {\n    actions: {\n        revealCard: '[data-action=\"mod_vocabcoach/reveal-card\"]',\n        updateVocab: '[data-action=\"mod_vocabcoach/update-vocab\"]',\n        endCheck: '[data-action=\"mod_vocabcoach/end-check\"]',\n        modeChanged: '[data-action=\"mod-vocabcoach/change-mode\"]',\n        checkTypedVocab: '[data-action=\"mod-vocabcoach/typed-vocab-check\"]',\n        revealTypedVocab: '[data-action=\"mod-vocabcoach/typed-vocab-reveal\"]',\n        typedVocabUnkown: '[data-action=\"mod-vocabcoach/typed-vocab-unknown\"]',\n    },\n    formElements : {\n        mode: '[id=\"check-mode\"]',\n        typedVocab: '[id=\"input-vocab-front\"]',\n    },\n};\nexport function changeMode() {\n    mode = document.getElementById('check-mode').value;\n    if (mode === 'type') {\n        document.getElementById('check-front').style.display = 'none';\n        document.getElementById('check-type-area').style.display = 'unset';\n        document.getElementById('input-vocab-front').value = '';\n        document.getElementById('check-buttons').style.display = 'none';\n        document.getElementsByClassName('instruction-front-back-random')[0].style.display = 'none';\n    } else {\n        document.getElementById('check-front').style.display = 'unset';\n        document.getElementById('check-type-area').style.display = 'none';\n        document.getElementById('check-buttons').removeAttribute('style');\n        document.getElementsByClassName('instruction-front-back-random')[0].style.display = 'unset';\n    }\n\n    if (mode === 'front' || mode === 'back') {\n        resetCheckFields(mode);\n    }\n}\n\nfunction getBoxVocab (userid, stage)  {\n    getBoxArrayAJAX(userid, modid, stage).then(response => {\n        vocabArrayJSON = response;\n        showNext();\n        }\n    );\n}\n\nfunction getListVocab (listid)  {\n    getListArrayAJAX(listid).then(response => {\n            vocabArrayJSON = response;\n            showNext();\n        }\n    );\n}\n\nfunction checkTypedVocab (userid) {\n    const currElementDataID = parseInt(document.getElementById('check-container').getAttribute('data-vocab-data-id'));\n\n    if (currElementDataID !== -1 && vocabArrayJSON[0].dataid !== currElementDataID) { // This is weird and shouldn't happen!\n        console.log(\"currElementID does not equal 0-element in vocabArrayJSON\");\n        return;\n    }\n\n    const typed = document.getElementById('input-vocab-front').value;\n    const correct = vocabArrayJSON[0].front;\n\n    if (typed === correct) {\n        updateVocabAJAX(vocabArrayJSON[0].dataid, userid, true).then(\n            () => {\n                knownCount++;\n                showNext();\n            }\n        );\n    } else {\n        document.getElementById('input-vocab-front').classList.add('wrong');\n    }\n}\nfunction showNext() {\n    const currElementDataID = parseInt(document.getElementById('check-container').getAttribute('data-vocab-data-id'));\n\n    if (currElementDataID !== -1 && vocabArrayJSON[0].dataid !== currElementDataID) { // This is weird and shouldn't happen!\n        console.log(\"currElementID does not equal 0-element in vocabArrayJSON\");\n        return;\n    }\n\n    if (currElementDataID !== -1) {\n        vocabArrayJSON.splice(0, 1);\n    }\n\n    const numberRemaining = vocabArrayJSON.length;\n    document.getElementsByClassName('check-number-remaining')[0].innerHTML = 'Noch ' + numberRemaining +\n        ' Vokabel' + (numberRemaining === 1 ? '' : 'n');\n\n    if (numberRemaining === 0) {\n        showSummary();\n        return;\n    }\n\n    document.getElementById('check-front').innerHTML = vocabArrayJSON[0].front;\n    document.getElementById('check-back').innerHTML = vocabArrayJSON[0].back;\n    document.getElementById('check-container').setAttribute('data-vocab-data-id', vocabArrayJSON[0].dataid);\n\n    if (mode === 'random') {\n        const random = Math.floor(Math.random() * 2) === 0;\n        resetCheckFields(random);\n    } else if (mode === 'type') {\n        document.getElementById('input-vocab-front').value = '';\n    } else {\n        resetCheckFields(mode);\n    }\n}\n\nfunction resetCheckFields(side) {\n    document.getElementById('check-front').style.display = (side === 'front' ? 'unset' : 'none');\n    document.getElementById('check-back').style.display = (side === 'front' ? 'none' : 'unset');\n}\n\nfunction endCheck() {\n    location.href = '../../mod/vocabcoach/view.php?id=' + modid;\n}\n\nfunction showSummary() {\n    const templateData = {\n        known: knownCount,\n        total: knownCount + unknownCount,\n        message: getSummaryMessage()\n    };\n    fetch('../../mod/vocabcoach/templates/check_summary.mustache').then(\n        (res) => {\n            return res.text();\n        }\n    ).then(\n        (template) => {\n            const output = mustache.render(template, templateData);\n            document.getElementsByClassName('check-summary')[0].innerHTML = output;\n        }\n    );\n\n    document.getElementById('check-box-front').style.display = 'none';\n    document.getElementById('check-box-back').style.display = 'none';\n}\n\nfunction getSummaryMessage() {\n    const ratio = knownCount/(unknownCount + knownCount);\n\n    if (ratio > 0.9) {\n        return \"Hervorragend!\";\n    }\n    if (ratio > 0.7) {\n        return \"Gut gemacht!\";\n    }\n    if (ratio > 0.5) {\n        return \"Du hast einiges erreicht!\";\n    }\n    if (ratio > 0.3) {\n        return \"Das kannst du besser!\";\n    }\n    return \"Hm. Da musst du nochmal ran!\";\n}\n\nfunction reveal(triggeringBox) {\n    const element = triggeringBox.childNodes[0];\n    if (element.style.display === 'none') {\n        element.style.display = 'unset';\n    }\n}\n\nfunction checkDone(vocabId, userId, known) {\n    if (userId !== -1) {\n        updateVocabAJAX(vocabId, userId, known).then(\n            () => {\n                updateCount(known);\n                showNext();\n            }\n        );\n    }\n    else {\n        updateCount(known);\n        showNext();\n    }\n}\n\nfunction updateCount(known) {\n    if (known) {\n        knownCount++;\n    } else {\n        unknownCount++;\n    }\n}\n"],"names":["vocabArrayJSON","modid","knownCount","unknownCount","mode","userid","addInfo","moduleid","listid","parseInt","then","response","showNext","stage","getBoxVocab","document","addEventListener","e","vocabId","userId","known","target","closest","Selectors","actions","checkTypedVocab","currElementDataID","getElementById","getAttribute","dataid","console","log","typed","value","correct","front","classList","add","revealCard","triggeringBox","element","childNodes","style","display","reveal","updateVocab","updateCount","endCheck","location","href","revealTypedVocab","disabled","typedVocabUnkown","formElements","changeMode","typedVocab","remove","addListeners","resetCheckFields","modeChanged","getElementsByClassName","removeAttribute","splice","numberRemaining","length","innerHTML","back","setAttribute","Math","floor","random","templateData","total","message","getSummaryMessage","fetch","res","text","template","output","mustache","render","showSummary","side","ratio"],"mappings":"uSAGIA,eAAiB,KACjBC,OAAS,EACTC,WAAa,EACbC,aAAe,EACfC,KAAO,sBAES,CAACC,OAAQC,QAASC,gBA8FfC,OA7FnBP,MAAQM,UAEQ,KADhBF,OAASI,SAASJ,UA4FCG,OA1FFF,yCA2FAE,QAAQE,MAAKC,WACtBX,eAAiBW,SACjBC,wBAXUP,OAAQQ,uCACVR,OAAQJ,MAAOY,OAAOH,MAAKC,WACvCX,eAAiBW,SACjBC,cAnFAE,CAAYT,OAAQC,kBAMND,QAClBU,SAASC,iBAAiB,SAASC,QAyMpBC,QAASC,OAAQC,MAxMxBH,EAAEI,OAAOC,QAAQC,UAAUC,QAAQC,0BAwFrBpB,cAChBqB,kBAAoBjB,SAASM,SAASY,eAAe,mBAAmBC,aAAa,2BAEhE,IAAvBF,mBAA4B1B,eAAe,GAAG6B,SAAWH,8BACzDI,QAAQC,IAAI,kEAIVC,MAAQjB,SAASY,eAAe,qBAAqBM,MACrDC,QAAUlC,eAAe,GAAGmC,MAE9BH,QAAUE,wCACMlC,eAAe,GAAG6B,OAAQxB,QAAQ,GAAMK,MACpD,KACIR,aACAU,cAIRG,SAASY,eAAe,qBAAqBS,UAAUC,IAAI,SA1GvDZ,CAAgBpB,QACTY,EAAEI,OAAOC,QAAQC,UAAUC,QAAQc,aAAwB,SAATlC,cA+LrDmC,qBACNC,QAAUD,cAAcE,WAAW,GACX,SAA1BD,QAAQE,MAAMC,UACdH,QAAQE,MAAMC,QAAU,SAjMpBC,CAAO3B,EAAEI,QACFJ,EAAEI,OAAOC,QAAQC,UAAUC,QAAQqB,cAoMnC3B,QAnMGlB,eAAe,GAAG6B,OAmMZV,OAnMoBd,OAmMZe,MAnMuE,SAAnDH,EAAEI,OAAOO,aAAa,0BAoM1D,IAAZT,uCACgBD,QAASC,OAAQC,OAAOV,MACpC,KACIoC,YAAY1B,OACZR,eAKRkC,YAAY1B,OACZR,aA7MWK,EAAEI,OAAOC,QAAQC,UAAUC,QAAQuB,UAiJlDC,SAASC,KAAO,oCAAsChD,MA/IvCgB,EAAEI,OAAOC,QAAQC,UAAUC,QAAQ0B,mBAC1CnC,SAASY,eAAe,qBAAqBM,MAAQjC,eAAe,GAAGmC,MACvEpB,SAASY,eAAe,qBAAqBwB,UAAW,EACxDpC,SAASY,eAAe,2BAA2Be,MAAMC,QAAU,QACnE5B,SAASY,eAAe,4BAA4Be,MAAMC,QAAU,OACpE5B,SAASY,eAAe,6BAA6Be,MAAMC,QAAU,QAC9D1B,EAAEI,OAAOC,QAAQC,UAAUC,QAAQ4B,oBAC1CrC,SAASY,eAAe,2BAA2Be,MAAMC,QAAU,OACnE5B,SAASY,eAAe,qBAAqBM,MAAQ,GACrDlB,SAASY,eAAe,qBAAqBwB,UAAW,EACxDpC,SAASY,eAAe,4BAA4Be,MAAMC,QAAU,QACpE5B,SAASY,eAAe,6BAA6Be,MAAMC,QAAU,wCACrD3C,eAAe,GAAG6B,OAAQxB,QAAQ,GAAOK,MAAK,KAAQE,kBAI9EG,SAASC,iBAAiB,UAAUC,IAC5BA,EAAEI,OAAOC,QAAQC,UAAU8B,aAAajD,OACxCkD,gBAIRvC,SAASC,iBAAiB,SAASC,IAC3BA,EAAEI,OAAOC,QAAQC,UAAU8B,aAAaE,aACxCxC,SAASY,eAAe,qBAAqBS,UAAUoB,OAAO,YAtCtEC,CAAapD,QACbqD,0BA0CEnC,UAAY,CACdC,QAAS,CACLc,WAAY,6CACZO,YAAa,8CACbE,SAAU,2CACVY,YAAa,6CACblC,gBAAiB,mDACjByB,iBAAkB,oDAClBE,iBAAkB,sDAEtBC,aAAe,CACXjD,KAAM,oBACNmD,WAAY,sCAGJD,aACZlD,KAAOW,SAASY,eAAe,cAAcM,MAChC,SAAT7B,MACAW,SAASY,eAAe,eAAee,MAAMC,QAAU,OACvD5B,SAASY,eAAe,mBAAmBe,MAAMC,QAAU,QAC3D5B,SAASY,eAAe,qBAAqBM,MAAQ,GACrDlB,SAASY,eAAe,iBAAiBe,MAAMC,QAAU,OACzD5B,SAAS6C,uBAAuB,iCAAiC,GAAGlB,MAAMC,QAAU,SAEpF5B,SAASY,eAAe,eAAee,MAAMC,QAAU,QACvD5B,SAASY,eAAe,mBAAmBe,MAAMC,QAAU,OAC3D5B,SAASY,eAAe,iBAAiBkC,gBAAgB,SACzD9C,SAAS6C,uBAAuB,iCAAiC,GAAGlB,MAAMC,QAAU,SAG3E,UAATvC,MAA6B,SAATA,MACpBsD,iBAAiBtD,eA0ChBQ,iBACCc,kBAAoBjB,SAASM,SAASY,eAAe,mBAAmBC,aAAa,2BAEhE,IAAvBF,mBAA4B1B,eAAe,GAAG6B,SAAWH,8BACzDI,QAAQC,IAAI,6DAIW,IAAvBL,mBACA1B,eAAe8D,OAAO,EAAG,SAGvBC,gBAAkB/D,eAAegE,UACvCjD,SAAS6C,uBAAuB,0BAA0B,GAAGK,UAAY,QAAUF,gBAC/E,YAAkC,IAApBA,gBAAwB,GAAK,KAEvB,IAApBA,mBAKJhD,SAASY,eAAe,eAAesC,UAAYjE,eAAe,GAAGmC,MACrEpB,SAASY,eAAe,cAAcsC,UAAYjE,eAAe,GAAGkE,KACpEnD,SAASY,eAAe,mBAAmBwC,aAAa,qBAAsBnE,eAAe,GAAG6B,QAEnF,WAATzB,KAAmB,CAEnBsD,iBADiD,IAAlCU,KAAKC,MAAsB,EAAhBD,KAAKE,eAEf,SAATlE,KACPW,SAASY,eAAe,qBAAqBM,MAAQ,GAErDyB,iBAAiBtD,4BAcfmE,aAAe,CACjBnD,MAAOlB,WACPsE,MAAOtE,WAAaC,aACpBsE,QAASC,qBAEbC,MAAM,yDAAyDjE,MAC1DkE,KACUA,IAAIC,SAEjBnE,MACGoE,iBACSC,OAASC,kBAASC,OAAOH,SAAUP,cACzCxD,SAAS6C,uBAAuB,iBAAiB,GAAGK,UAAYc,UAIxEhE,SAASY,eAAe,mBAAmBe,MAAMC,QAAU,OAC3D5B,SAASY,eAAe,kBAAkBe,MAAMC,QAAU,OA7CtDuC,YAkBCxB,iBAAiByB,MACtBpE,SAASY,eAAe,eAAee,MAAMC,QAAoB,UAATwC,KAAmB,QAAU,OACrFpE,SAASY,eAAe,cAAce,MAAMC,QAAoB,UAATwC,KAAmB,OAAS,iBA4B9ET,0BACCU,MAAQlF,YAAYC,aAAeD,mBAErCkF,MAAQ,GACD,gBAEPA,MAAQ,GACD,eAEPA,MAAQ,GACD,4BAEPA,MAAQ,GACD,wBAEJ,wCAyBFtC,YAAY1B,OACbA,MACAlB,aAEAC"}