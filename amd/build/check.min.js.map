{"version":3,"file":"check.min.js","sources":["../src/check.js"],"sourcesContent":["import {getBoxArrayAJAX, getListArrayAJAX, updateVocabAJAX} from \"./repository\";\nimport mustache from 'core/mustache';\nimport {showElement, showElements} from \"./general\";\n\nlet vocabArrayJSON = null;\nlet modid = -1;\nlet knownCount = 0;\nlet unknownCount = 0;\nlet mode = 'front';\nlet force = false;\n\nexport const init = (userid, addInfo, moduleid, force_init = false) => {\n    modid = moduleid;\n    userid = parseInt(userid);\n    force = force_init;\n    if (userid === -1) {\n        getListVocab(addInfo);\n    } else {\n        getBoxVocab(userid, addInfo, force);\n    }\n    addListeners(userid);\n    resetCheckFields();\n};\n\nfunction addListeners(userid) {\n    document.addEventListener('click', e => {\n        if (e.target.closest(Selectors.actions.checkTypedVocab)) {\n            checkTypedVocab(userid);\n        } else if (e.target.closest(Selectors.actions.revealCard) && mode !== 'type') {\n            const label = e.target.closest(Selectors.actions.revealCard).getElementsByClassName('vc-check-label')[0];\n            showElement(label, true);\n        } else if (e.target.closest(Selectors.actions.updateVocab)) {\n            checkDone(vocabArrayJSON[0].dataid, userid, e.target.getAttribute('data-vocabcoach-known') === 'true');\n        } else if (e.target.closest(Selectors.actions.endCheck)) {\n            endCheck();\n        } else if (e.target.closest(Selectors.actions.revealTypedVocab)) {\n            document.getElementById('input-vocab-front').value = vocabArrayJSON[0].front;\n            document.getElementById('input-vocab-front').disabled = true;\n\n            showElements(['button-typed-vocab-next'], true);\n            showElements(['button-typed-vocab-check', 'button-typed-vocab-reveal'], false);\n        } else if (e.target.closest(Selectors.actions.typedVocabUnknown)) {\n            showElements(['button-typed-vocab-next'], false);\n            showElements(['button-typed-vocab-reveal', 'button-typed-vocab-check'], true);\n\n            document.getElementById('input-vocab-front').value = '';\n            document.getElementById('input-vocab-front').disabled = false;\n\n            updateVocabAJAX(vocabArrayJSON[0].dataid, userid, false).then(() => { showNext();});\n        }\n    });\n\n    document.addEventListener('change', e => {\n        if (e.target.closest(Selectors.formElements.mode)) {\n            changeMode();\n        }\n    });\n\n    document.addEventListener('keyup', e => {\n        if (e.target.closest(Selectors.formElements.typedVocab)) {\n            document.getElementById('input-vocab-front').classList.remove('wrong');\n        }\n    });\n}\n\nconst Selectors = {\n    actions: {\n        revealCard: '[data-action=\"mod_vocabcoach/reveal-card\"]',\n        updateVocab: '[data-action=\"mod_vocabcoach/update-vocab\"]',\n        endCheck: '[data-action=\"mod_vocabcoach/end-check\"]',\n        modeChanged: '[data-action=\"mod-vocabcoach/change-mode\"]',\n        checkTypedVocab: '[data-action=\"mod-vocabcoach/typed-vocab-check\"]',\n        revealTypedVocab: '[data-action=\"mod-vocabcoach/typed-vocab-reveal\"]',\n        typedVocabUnknown: '[data-action=\"mod-vocabcoach/typed-vocab-unknown\"]',\n    },\n    formElements : {\n        mode: '[id=\"check-mode\"]',\n        typedVocab: '[id=\"input-vocab-front\"]',\n    },\n};\nexport function changeMode() {\n    mode = document.getElementById('check-mode').value;\n    if (mode === 'type') {\n        showElements(['check-front', 'check-buttons', ], false);\n        showElements(['check-back', 'check-type-area'], true);\n        document.getElementById('input-vocab-front').value = '';\n        showElement(document.getElementsByClassName('instruction-front-back-random')[0], false);\n    } else {\n        showElements(['check-front', 'check-buttons'], true);\n        showElements(['check-type-area'], false);\n        showElement(document.getElementsByClassName('instruction-front-back-random')[0], true);\n    }\n\n    if (mode === 'front' || mode === 'back') {\n        resetCheckFields(mode);\n    }\n}\n\nfunction getBoxVocab (userid, stage, force)  {\n    getBoxArrayAJAX(userid, modid, stage, force).then(response => {\n        vocabArrayJSON = response;\n        showNext();\n        }\n    );\n}\n\nfunction getListVocab (listid)  {\n    getListArrayAJAX(listid).then(response => {\n            vocabArrayJSON = response;\n            showNext();\n        }\n    );\n}\n\nfunction checkTypedVocab (userid) {\n    const currElementDataID = parseInt(document.getElementById('check-container').getAttribute('data-vocab-data-id'));\n\n    if (currElementDataID !== -1 && vocabArrayJSON[0].dataid !== currElementDataID) { // This is weird and shouldn't happen!\n        console.log(\"currElementID does not equal 0-element in vocabArrayJSON\");\n        return;\n    }\n\n    const typed = document.getElementById('input-vocab-front').value;\n    const correct = vocabArrayJSON[0].front;\n\n    if (typed === correct && !force) {\n        updateVocabAJAX(vocabArrayJSON[0].dataid, userid, true).then(\n            () => {\n                knownCount++;\n                showNext();\n            }\n        );\n    } else if (typed === correct) {\n        knownCount++;\n        showNext();\n    } else {\n        document.getElementById('input-vocab-front').classList.add('wrong');\n    }\n}\nfunction showNext() {\n    const currElementDataID = parseInt(document.getElementById('check-container').getAttribute('data-vocab-data-id'));\n\n    if (currElementDataID !== -1 && vocabArrayJSON[0].dataid !== currElementDataID) { // This is weird and shouldn't happen!\n        console.log(\"currElementID does not equal 0-element in vocabArrayJSON\");\n        return;\n    }\n\n    if (currElementDataID !== -1) {\n        vocabArrayJSON.splice(0, 1);\n    }\n\n    const numberRemaining = vocabArrayJSON.length;\n    document.getElementsByClassName('check-number-remaining')[0].innerHTML = 'Noch ' + numberRemaining +\n        ' Vokabel' + (numberRemaining === 1 ? '' : 'n');\n\n    if (numberRemaining === 0) {\n        showSummary();\n        return;\n    }\n\n    document.getElementById('check-front').innerHTML = vocabArrayJSON[0].front;\n    document.getElementById('check-back').innerHTML = vocabArrayJSON[0].back;\n    document.getElementById('check-container').setAttribute('data-vocab-data-id', vocabArrayJSON[0].dataid);\n\n    if (mode === 'random') {\n        const random = Math.floor(Math.random() * 2) === 0;\n        resetCheckFields(random);\n    } else if (mode === 'type') {\n        document.getElementById('input-vocab-front').value = '';\n    } else {\n        resetCheckFields(mode);\n    }\n}\n\nfunction resetCheckFields(side) {\n    showElement('check-front', side === 'front');\n    showElement('check-back', side !== 'front');\n}\n\nfunction endCheck() {\n    location.href = '../../mod/vocabcoach/view.php?id=' + modid;\n}\n\nfunction showSummary() {\n    const templateData = {\n        known: knownCount,\n        total: knownCount + unknownCount,\n        message: getSummaryMessage()\n    };\n    fetch('../../mod/vocabcoach/templates/check_summary.mustache').then(\n        (res) => {\n            return res.text();\n        }\n    ).then(\n        (template) => {\n            const output = mustache.render(template, templateData);\n            const summaryContainer = document.getElementsByClassName('check-summary')[0];\n            summaryContainer.innerHTML = output;\n            showElement(summaryContainer, true);\n            showElements(['check-box-front', 'check-box-back'], false);\n        }\n    );\n\n\n}\n\nfunction getSummaryMessage() {\n    const ratio = knownCount/(unknownCount + knownCount);\n\n    if (ratio > 0.9) {\n        return \"Hervorragend!\";\n    }\n    if (ratio > 0.7) {\n        return \"Gut gemacht!\";\n    }\n    if (ratio > 0.5) {\n        return \"Du hast einiges erreicht!\";\n    }\n    if (ratio > 0.3) {\n        return \"Das kannst du besser!\";\n    }\n    return \"Hm. Da musst du nochmal ran!\";\n}\n\nfunction checkDone(vocabId, userId, known) {\n    if (userId === -1 || force) {\n        updateCount(known);\n        showNext();\n    }\n    else {\n    updateVocabAJAX(vocabId, userId, known).then(\n            () => {\n                updateCount(known);\n                showNext();\n            }\n        );\n    }\n}\n\nfunction updateCount(known) {\n    if (known) {\n        knownCount++;\n    } else {\n        unknownCount++;\n    }\n}\n"],"names":["vocabArrayJSON","modid","knownCount","unknownCount","mode","force","addListeners","userid","document","addEventListener","e","target","closest","Selectors","actions","checkTypedVocab","currElementDataID","parseInt","getElementById","getAttribute","dataid","console","log","typed","value","correct","front","showNext","classList","add","then","revealCard","label","getElementsByClassName","updateVocab","vocabId","userId","known","updateCount","endCheck","location","href","revealTypedVocab","disabled","typedVocabUnknown","formElements","changeMode","typedVocab","remove","addInfo","moduleid","force_init","getListVocab","getBoxVocab","resetCheckFields","modeChanged","stage","response","listid","splice","numberRemaining","length","innerHTML","back","setAttribute","Math","floor","random","templateData","total","message","getSummaryMessage","fetch","res","text","template","output","mustache","render","summaryContainer","showSummary","side","ratio"],"mappings":"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"}