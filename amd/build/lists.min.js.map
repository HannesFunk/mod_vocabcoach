{"version":3,"file":"lists.min.js","sources":["../src/lists.js"],"sourcesContent":["import {addListToUserAJAX, deleteListAJAX, getListsAJAX} from \"./repository\";\nimport mustache from 'core/mustache';\nimport notification, {saveCancel} from 'core/notification';\nimport Log from 'core/log';\n\nlet vocabcoachId;\nlet userId;\n\nfunction addListToUser(listid) {\n    addListToUserAJAX(listid, userId, vocabcoachId).then(\n        () => {\n            const notificationData = {\n                message: \"Neue Vokabeln von dieser Liste wurden deinem Karteikarten hinzugefügt.\",\n                type: \"success\",\n            };\n            notification.addNotification(notificationData).then(null);\n        }\n    );\n}\n\nexport function init(cmid, userIdString, canEditAll) {\n    vocabcoachId = parseInt(cmid);\n    userId = parseInt(userIdString);\n\n    printLists(canEditAll);\n\n    document.addEventListener('click', e => {\n        if (e.target.closest(Selectors.actions.deleteList)) {\n            deleteList(e.target.getAttribute('data-list-id'));\n        } else if (e.target.closest(Selectors.actions.checkList)) {\n            location.href = 'check.php?id=' + vocabcoachId + '&mode=list&listid=' + e.target.getAttribute('data-list-id');\n        } else if (e.target.closest(Selectors.actions.showPdf)) {\n            const menuItem = e.target.closest(Selectors.actions.showPdf);\n            window.open('pages/vocablist_pdf.php?listid=' + menuItem.getAttribute('data-list-id'), '_blank').focus();\n        } else if (e.target.closest(Selectors.actions.editList)) {\n            const menuItem = e.target.closest(Selectors.actions.editList);\n            location.href = 'add_vocab.php?id=' + vocabcoachId + '&mode=edit&listid=' + menuItem.getAttribute('data-list-id');\n        } else if (e.target.closest(Selectors.actions.addListToUser)) {\n            const menuItem = e.target.closest(Selectors.actions.addListToUser);\n            addListToUser(menuItem.getAttribute('data-list-id'));\n        } else if (e.target.closest(Selectors.actions.closePage)) {\n            location.href = '../../mod/vocabcoach/view.php?id=' + vocabcoachId;\n        }\n    });\n}\n\nconst Selectors = {\n    actions: {\n        deleteList: '[data-action=\"mod_vocabcoach/delete_list\"]',\n        checkList: '[data-action=\"mod_vocabcoach/check_list\"]',\n        showPdf: '[data-action=\"mod_vocabcoach/show_pdf\"]',\n        editList: '[data-action=\"mod_vocabcoach/edit_list\"]',\n        addListToUser: '[data-action=\"mod_vocabcoach/add_list_to_user\"]',\n        closePage: '[data-action=\"mod_vocabcoach/close_page\"]',\n    }\n};\n\nexport function printLists(canEditAll) {\n    let json = null;\n    let template = null;\n    const getData = getListsAJAX(vocabcoachId).then(\n        res => {\n            res.forEach(list => {\n                list.editable = canEditAll || list.createdby === userId;\n            });\n            json = {'lists': res, 'loading': false};\n            if (res.length === 0) {\n                json.emptyList = true;\n            }\n        }\n    );\n\n    const fetchTemplate = fetch('../../mod/vocabcoach/templates/lists.mustache').then(\n        (res) => { return res.text(); }\n    ).then(\n        (text) => { template = text; }\n    );\n\n    Promise.all([getData, fetchTemplate]).then(() => {\n            mustache.parse(template);\n            document.querySelectorAll('[role=\"main\"]')[0].innerHTML = mustache.render(template, json);\n            return true;\n        }\n    );\n}\n\nfunction deleteList(listid) {\n    saveCancel('Bestätigung', 'Soll diese Liste wirklich gelöscht werden?', 'Bestätigen', () => {\n        deleteListAJAX(listid).then(\n            () => {\n                document.querySelectorAll('tr[data-list-id=\"' + listid +'\"]')[0].remove();\n            }\n        );\n    }, null).catch ((error) => Log.debug(error));\n}\n"],"names":["vocabcoachId","userId","cmid","userIdString","canEditAll","parseInt","printLists","document","addEventListener","e","target","closest","Selectors","actions","deleteList","listid","getAttribute","then","querySelectorAll","remove","catch","error","Log","debug","checkList","location","href","showPdf","menuItem","window","open","focus","editList","addListToUser","notificationData","message","type","addNotification","closePage","json","template","getData","res","forEach","list","editable","createdby","length","emptyList","fetchTemplate","fetch","text","Promise","all","parse","innerHTML","mustache","render"],"mappings":"8gBAKIA,aACAC,sFAciBC,KAAMC,aAAcC,YACrCJ,aAAeK,SAASH,MACxBD,OAASI,SAASF,cAElBG,WAAWF,YAEXG,SAASC,iBAAiB,SAASC,OAC3BA,EAAEC,OAAOC,QAAQC,UAAUC,QAAQC,YA2D3BC,OA1DGN,EAAEC,OAAOM,aAAa,6CA2D9B,cAAe,6CAA8C,cAAc,oCACnED,QAAQE,MACnB,KACIV,SAASW,iBAAiB,oBAAsBH,OAAQ,MAAM,GAAGI,cAG1E,MAAMC,OAAQC,OAAUC,aAAIC,MAAMF,cAhE1B,GAAIZ,EAAEC,OAAOC,QAAQC,UAAUC,QAAQW,WAC1CC,SAASC,KAAO,gBAAkB1B,aAAe,qBAAuBS,EAAEC,OAAOM,aAAa,qBAC3F,GAAIP,EAAEC,OAAOC,QAAQC,UAAUC,QAAQc,SAAU,OAC9CC,SAAWnB,EAAEC,OAAOC,QAAQC,UAAUC,QAAQc,SACpDE,OAAOC,KAAK,kCAAoCF,SAASZ,aAAa,gBAAiB,UAAUe,aAC9F,GAAItB,EAAEC,OAAOC,QAAQC,UAAUC,QAAQmB,UAAW,OAC/CJ,SAAWnB,EAAEC,OAAOC,QAAQC,UAAUC,QAAQmB,UACpDP,SAASC,KAAO,oBAAsB1B,aAAe,qBAAuB4B,SAASZ,aAAa,qBAC/F,GAAIP,EAAEC,OAAOC,QAAQC,UAAUC,QAAQoB,eAAgB,WA7B/ClB,0CACDA,OAAQd,OAAQD,cAAciB,MAC5C,WACUiB,iBAAmB,CACrBC,QAAS,yEACTC,KAAM,iCAEGC,gBAAgBH,kBAAkBjB,KAAK,SAwBpDgB,CADiBxB,EAAEC,OAAOC,QAAQC,UAAUC,QAAQoB,eAC7BjB,aAAa,sBAC7BP,EAAEC,OAAOC,QAAQC,UAAUC,QAAQyB,aAC1Cb,SAASC,KAAO,oCAAsC1B,kBA6C9Ce,wyBAxCdH,UAAY,CACdC,QAAS,CACLC,WAAY,6CACZU,UAAW,4CACXG,QAAS,0CACTK,SAAU,2CACVC,cAAe,kDACfK,UAAW,uDAIHhC,WAAWF,gBACnBmC,KAAO,KACPC,SAAW,WACTC,SAAU,4BAAazC,cAAciB,MACvCyB,MACIA,IAAIC,SAAQC,OACRA,KAAKC,SAAWzC,YAAcwC,KAAKE,YAAc7C,UAErDsC,KAAO,OAAUG,aAAgB,GACd,IAAfA,IAAIK,SACJR,KAAKS,WAAY,MAKvBC,cAAgBC,MAAM,iDAAiDjC,MACxEyB,KAAiBA,IAAIS,SACxBlC,MACGkC,OAAWX,SAAWW,QAG3BC,QAAQC,IAAI,CAACZ,QAASQ,gBAAgBhC,MAAK,uBAC1BqC,MAAMd,UACfjC,SAASW,iBAAiB,iBAAiB,GAAGqC,UAAYC,kBAASC,OAAOjB,SAAUD,OAC7E"}