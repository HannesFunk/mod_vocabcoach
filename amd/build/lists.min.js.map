{"version":3,"file":"lists.min.js","sources":["../src/lists.js"],"sourcesContent":["import {addListToUserAJAX, deleteListAJAX, distributeListAJAX, getListsAJAX} from \"./repository\";\nimport mustache from 'core/mustache';\nimport notification, {saveCancel} from 'core/notification';\nimport Log from 'core/log';\n\nlet cmid;\nlet userId;\n\nfunction addListToUser(listid) {\n    addListToUserAJAX(listid, userId, cmid).then(\n        () => {\n            const notificationData = {\n                message: \"Neue Vokabeln von dieser Liste wurden deinem Karteikarten hinzugefügt.\",\n                type: \"success\",\n            };\n            notification.addNotification(notificationData).then(null);\n        }\n    );\n}\n\nexport function init(moduleId, userIdString, capabilitiesInfo) {\n    cmid = parseInt(moduleId);\n    userId = parseInt(userIdString);\n\n    printLists(JSON.parse(capabilitiesInfo));\n\n    document.addEventListener('click', e => {\n        if (e.target.closest(Selectors.actions.deleteList)) {\n            deleteList(e.target.getAttribute('data-list-id'));\n        } else if (e.target.closest(Selectors.actions.checkList)) {\n            location.href = 'check.php?id=' + cmid + '&source=list&listid=' + e.target.getAttribute('data-list-id');\n        } else if (e.target.closest(Selectors.actions.showPdf)) {\n            const menuItem = e.target.closest(Selectors.actions.showPdf);\n            window.open('vocablist_pdf.php?listid=' + menuItem.getAttribute('data-list-id')+\"&cmid=\"+cmid, '_blank').focus();\n        } else if (e.target.closest(Selectors.actions.editList)) {\n            const menuItem = e.target.closest(Selectors.actions.editList);\n            location.href = 'add_vocab.php?id=' + cmid + '&mode=edit&listid=' + menuItem.getAttribute('data-list-id');\n        } else if (e.target.closest(Selectors.actions.addListToUser)) {\n            const menuItem = e.target.closest(Selectors.actions.addListToUser);\n            addListToUser(menuItem.getAttribute('data-list-id'));\n        } else if (e.target.closest(Selectors.actions.closePage)) {\n            location.href = '../../mod/vocabcoach/view.php?id=' + cmid;\n        }else if (e.target.closest(Selectors.actions.toggleUserSwitch)) {\n            const userSwitch = document.getElementById('userswitch');\n            const newState = !userSwitch.checked;\n            userSwitch.checked = newState;\n            printLists(capabilitiesInfo, newState);\n        } else if (e.target.closest(Selectors.actions.distributeList)) {\n            const menuItem = e.target.closest(Selectors.actions.distributeList);\n            distributeList(menuItem.getAttribute('data-list-id'), cmid);\n\n        }\n    });\n\n    document.addEventListener('change', (e) => {\n        if (e.target.getAttribute('data-action') === 'toggle-user-switch') {\n            printLists(capabilitiesInfo, true);\n        }\n    });\n}\n\nconst Selectors = {\n    actions: {\n        deleteList: '[data-action=\"mod_vocabcoach/delete_list\"]',\n        checkList: '[data-action=\"mod_vocabcoach/check_list\"]',\n        showPdf: '[data-action=\"mod_vocabcoach/show_pdf\"]',\n        editList: '[data-action=\"mod_vocabcoach/edit_list\"]',\n        addListToUser: '[data-action=\"mod_vocabcoach/add_list_to_user\"]',\n        closePage: '[data-action=\"mod_vocabcoach/close_page\"]',\n        distributeList: '[data-action=\"mod_vocabcoach/distribute_list\"]',\n        toggleUserSwitch: '[data-action=\"mod_vocabcoach/toggle-user-switch\"]',\n    }\n};\n\nexport function printLists(capInfo, onlyOwnLists = false) {\n    let json = null;\n    let template = null;\n    const getData = getListsAJAX(cmid, userId, onlyOwnLists).then(\n        res => {\n            res.forEach(list => {\n                list.editable = capInfo.canEdit || list.createdby === userId;\n                list.distributable = capInfo.canDistribute;\n            });\n            json = {'lists': res, 'loading': false, 'cmid': cmid, 'onlyOwnLists': onlyOwnLists};\n            if (res.length === 0) {\n                json.emptyList = true;\n            }\n        }\n    );\n\n    const templateSource =  '../../mod/vocabcoach/templates/lists.mustache';\n    const fetchTemplate = fetch(templateSource).then(\n        (res) => { return res.text(); }\n    ).then(\n        (text) => { template = text; }\n    );\n\n    Promise.all([getData, fetchTemplate]).then(() => {\n            mustache.parse(template);\n            document.querySelectorAll('[role=\"main\"]')[0].innerHTML = mustache.render(template, json);\n            return true;\n        }\n    );\n}\n\nfunction deleteList(listid) {\n    saveCancel('Bestätigung', 'Soll diese Liste wirklich gelöscht werden?', 'Bestätigen', () => {\n        deleteListAJAX(listid).then(\n            () => {\n                document.querySelectorAll('tr[data-list-id=\"' + listid +'\"]')[0].remove();\n                notification.addNotification({type: 'success', message: 'Liste gelöscht.'}).then(null);\n            }\n        );\n    }, null).catch ((error) => Log.debug(error));\n}\n\nfunction distributeList(listid, vocabcoachId) {\n    const doIt = () => {\n        distributeListAJAX(listid, vocabcoachId).then(() => {\n            notification.addNotification(\n                {type: 'success', message: 'Liste an alle Teilnehmer in diesem Kurs verteilt.'}\n            ).then(null);\n        });\n    };\n\n    saveCancel('Bestätigung',\n        'Soll diese Liste wirklich an alle Teilnehmer in diesem Kurs verteilt werden?',\n        'Bestätigen',\n        doIt,\n        null).\n    catch((error) => Log.debug(error));\n}\n"],"names":["cmid","userId","moduleId","userIdString","capabilitiesInfo","parseInt","printLists","JSON","parse","document","addEventListener","e","target","closest","Selectors","actions","deleteList","listid","getAttribute","then","querySelectorAll","remove","addNotification","type","message","catch","error","Log","debug","checkList","location","href","showPdf","menuItem","window","open","focus","editList","addListToUser","notificationData","closePage","toggleUserSwitch","userSwitch","getElementById","newState","checked","distributeList","vocabcoachId","doIt","capInfo","onlyOwnLists","json","template","getData","res","forEach","list","editable","canEdit","createdby","distributable","canDistribute","length","emptyList","templateSource","fetchTemplate","fetch","text","Promise","all","innerHTML","mustache","render"],"mappings":"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"}